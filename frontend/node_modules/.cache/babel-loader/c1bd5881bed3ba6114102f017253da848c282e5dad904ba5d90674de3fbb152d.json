{"ast":null,"code":"class SSEService {\n  constructor() {\n    this.eventSource = null;\n    this.listeners = new Set();\n    this.isConnected = false;\n    this.messageCount = 0;\n  }\n  connect() {\n    if (this.eventSource) {\n      this.eventSource.close();\n    }\n    this.eventSource = new EventSource('http://localhost:3001/events');\n    this.eventSource.onopen = () => {\n      console.log('SSE连接已建立');\n      this.isConnected = true;\n      this.notifyListeners('connected', {\n        message: '连接已建立'\n      });\n    };\n    this.eventSource.onmessage = event => {\n      try {\n        const data = JSON.parse(event.data);\n        this.messageCount++;\n        this.notifyListeners('message', data);\n      } catch (error) {\n        console.error('解析SSE消息失败:', error);\n      }\n    };\n    this.eventSource.onerror = error => {\n      console.error('SSE连接错误:', error);\n      this.isConnected = false;\n      this.notifyListeners('error', {\n        error: '连接错误'\n      });\n    };\n  }\n  startStream(speed = 1000) {\n    if (!this.isConnected) {\n      throw new Error('请先连接SSE');\n    }\n    return fetch('http://localhost:3001/start-stream', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        speed: parseInt(speed)\n      })\n    }).then(response => response.json()).then(data => {\n      console.log('开始推送:', data);\n      return data;\n    }).catch(error => {\n      console.error('开始推送失败:', error);\n      throw error;\n    });\n  }\n  getStatus() {\n    return fetch('http://localhost:3001/status').then(response => response.json()).catch(error => {\n      console.error('获取状态失败:', error);\n      throw error;\n    });\n  }\n  addListener(callback) {\n    this.listeners.add(callback);\n    return () => this.listeners.delete(callback);\n  }\n  notifyListeners(eventType, data) {\n    this.listeners.forEach(callback => {\n      try {\n        callback(eventType, data);\n      } catch (error) {\n        console.error('通知监听器失败:', error);\n      }\n    });\n  }\n  getConnectionStatus() {\n    return this.isConnected;\n  }\n  getMessageCount() {\n    return this.messageCount;\n  }\n}\n\n// 创建单例实例\nconst sseService = new SSEService();\nexport default sseService;","map":{"version":3,"names":["SSEService","constructor","eventSource","listeners","Set","isConnected","messageCount","connect","close","EventSource","onopen","console","log","notifyListeners","message","onmessage","event","data","JSON","parse","error","onerror","startStream","speed","Error","fetch","method","headers","body","stringify","parseInt","then","response","json","catch","getStatus","addListener","callback","add","delete","eventType","forEach","getConnectionStatus","getMessageCount","sseService"],"sources":["/Users/tal/Desktop/streaming/frontend/src/services/sseService.js"],"sourcesContent":["class SSEService {\n  constructor() {\n    this.eventSource = null;\n    this.listeners = new Set();\n    this.isConnected = false;\n    this.messageCount = 0;\n  }\n\n  connect() {\n    if (this.eventSource) {\n      this.eventSource.close();\n    }\n\n    this.eventSource = new EventSource('http://localhost:3001/events');\n    \n    this.eventSource.onopen = () => {\n      console.log('SSE连接已建立');\n      this.isConnected = true;\n      this.notifyListeners('connected', { message: '连接已建立' });\n    };\n\n    this.eventSource.onmessage = (event) => {\n      try {\n        const data = JSON.parse(event.data);\n        this.messageCount++;\n        this.notifyListeners('message', data);\n      } catch (error) {\n        console.error('解析SSE消息失败:', error);\n      }\n    };\n\n    this.eventSource.onerror = (error) => {\n      console.error('SSE连接错误:', error);\n      this.isConnected = false;\n      this.notifyListeners('error', { error: '连接错误' });\n    };\n  }\n\n\n  startStream(speed = 1000) {\n    if (!this.isConnected) {\n      throw new Error('请先连接SSE');\n    }\n\n    return fetch('http://localhost:3001/start-stream', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ speed: parseInt(speed) })\n    })\n    .then(response => response.json())\n    .then(data => {\n      console.log('开始推送:', data);\n      return data;\n    })\n    .catch(error => {\n      console.error('开始推送失败:', error);\n      throw error;\n    });\n  }\n\n\n  getStatus() {\n    return fetch('http://localhost:3001/status')\n    .then(response => response.json())\n    .catch(error => {\n      console.error('获取状态失败:', error);\n      throw error;\n    });\n  }\n\n  addListener(callback) {\n    this.listeners.add(callback);\n    return () => this.listeners.delete(callback);\n  }\n\n  notifyListeners(eventType, data) {\n    this.listeners.forEach(callback => {\n      try {\n        callback(eventType, data);\n      } catch (error) {\n        console.error('通知监听器失败:', error);\n      }\n    });\n  }\n\n  getConnectionStatus() {\n    return this.isConnected;\n  }\n\n  getMessageCount() {\n    return this.messageCount;\n  }\n}\n\n// 创建单例实例\nconst sseService = new SSEService();\nexport default sseService;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}