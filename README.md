# å®æ—¶æµå¼æ•°æ®æ¨é€é¡¹ç›®

è¿™æ˜¯ä¸€ä¸ªåŸºäºServer-Sent Events (SSE) çš„å®æ—¶æ•°æ®æ¨é€é¡¹ç›®ï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„æ¶æ„è®¾è®¡ï¼ŒåŒ…å«åç«¯æœåŠ¡å™¨å’Œå‰ç«¯æ¼”ç¤ºé¡µé¢ã€‚

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
streaming/
â”œâ”€â”€ backend/                 # åç«¯SSEæœåŠ¡å™¨
â”‚   â”œâ”€â”€ server.js           # ä¸»æœåŠ¡å™¨æ–‡ä»¶
â”‚   â”œâ”€â”€ data.json           # æ•°æ®å­˜å‚¨æ–‡ä»¶
â”‚   â”œâ”€â”€ package.json        # ä¾èµ–ç®¡ç†
â”‚   â””â”€â”€ README.md           # åç«¯è¯´æ˜æ–‡æ¡£
â””â”€â”€ frontend/               # Reactå‰ç«¯åº”ç”¨
    â”œâ”€â”€ src/                # æºä»£ç ç›®å½•
    â”‚   â”œâ”€â”€ App.js          # ä¸»åº”ç”¨ç»„ä»¶ï¼ˆç®€åŒ–åï¼‰
    â”‚   â”œâ”€â”€ components/     # Reactç»„ä»¶
    â”‚   â”‚   â”œâ”€â”€ Step.js     # æ­¥éª¤ç»„ä»¶
    â”‚   â”‚   â”œâ”€â”€ Think.js    # æ€è€ƒç»„ä»¶
    â”‚   â”‚   â”œâ”€â”€ Text.js     # æ–‡æœ¬ç»„ä»¶
    â”‚   â”‚   â””â”€â”€ Search.js   # æœç´¢ç»„ä»¶
    â”‚   â””â”€â”€ services/       # æœåŠ¡å±‚
    â”‚       â”œâ”€â”€ sseService.js      # SSEè¿æ¥æœåŠ¡
    â”‚       â””â”€â”€ componentManager.js # ç»„ä»¶ç®¡ç†å™¨ âœ¨
    â”œâ”€â”€ package.json        # å‰ç«¯ä¾èµ–
    â””â”€â”€ public/             # é™æ€èµ„æº
```

## ğŸš€ æ¶æ„ä¼˜åŠ¿

### é‡æ„åçš„æ”¹è¿›
- **èŒè´£åˆ†ç¦»**: æ¯ä¸ªæ¨¡å—éƒ½æœ‰æ˜ç¡®çš„èŒè´£
- **å¯ç»´æŠ¤æ€§**: ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
- **å¯æµ‹è¯•æ€§**: ç»„ä»¶ç®¡ç†å™¨å¯ä»¥ç‹¬ç«‹æµ‹è¯•
- **ä»£ç å¤ç”¨**: é¿å…äº†é‡å¤çš„ç»„ä»¶ç®¡ç†é€»è¾‘
- **æ€§èƒ½ä¼˜åŒ–**: æ›´é«˜æ•ˆçš„ç»„ä»¶çŠ¶æ€ç®¡ç†

## åŠŸèƒ½ç‰¹æ€§

### åç«¯ (SSEæœåŠ¡å™¨)
- âœ… å®æ—¶æ•°æ®æ¨é€ (Server-Sent Events)
- âœ… åŸºäºJSONæ–‡ä»¶çš„æ•°æ®å­˜å‚¨
- âœ… æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è¿æ¥
- âœ… å¯æ§åˆ¶æ¨é€é€Ÿåº¦
- âœ… è¿æ¥çŠ¶æ€ç›‘æ§
- âœ… ä¼˜é›…å…³é—­å¤„ç†
- âœ… CORSæ”¯æŒ

### å‰ç«¯ (Reactåº”ç”¨)
- âœ… ç°ä»£åŒ–çš„Reactç•Œé¢
- âœ… å®æ—¶æ•°æ®å±•ç¤ºç»„ä»¶
- âœ… SSEè¿æ¥ç®¡ç†
- âœ… æ•°æ®æ¨é€æ§åˆ¶
- âœ… å¤šç§æ¶ˆæ¯ç±»å‹æ”¯æŒ (step, think, text, search)
- âœ… æ‰“å­—æœºåŠ¨ç”»æ•ˆæœ
- âœ… å“åº”å¼è®¾è®¡
- âœ… **ç»„ä»¶ç®¡ç†å™¨æ¶æ„** - ç»Ÿä¸€çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… **æ¨¡å—åŒ–è®¾è®¡** - æ¸…æ™°çš„èŒè´£åˆ†ç¦»

## å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨åç«¯æœåŠ¡å™¨

```bash
cd backend
npm install
node server.js
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:3001` å¯åŠ¨

### 2. å¯åŠ¨å‰ç«¯åº”ç”¨

```bash
cd frontend
npm install
npm start
```

å‰ç«¯åº”ç”¨å°†åœ¨ `http://localhost:3000` å¯åŠ¨

## APIç«¯ç‚¹

### SSEè¿æ¥
- **GET** `/events` - å»ºç«‹SSEè¿æ¥

### æ§åˆ¶ç«¯ç‚¹
- **POST** `/start-stream` - å¼€å§‹æ¨é€æ•°æ®
  ```json
  {
    "speed": 1000  // æ¨é€é—´éš”ï¼ˆæ¯«ç§’ï¼‰
  }
  ```

- **POST** `/stop-stream` - åœæ­¢æ¨é€æ•°æ®
- **POST** `/reset` - é‡ç½®æ•°æ®

### çŠ¶æ€ç«¯ç‚¹
- **GET** `/status` - è·å–æœåŠ¡å™¨çŠ¶æ€

## æ•°æ®æ ¼å¼

æœåŠ¡å™¨æ¨é€çš„JSONæ•°æ®æ ¼å¼ï¼š

```json
{
  "msg_id": "765881551455182850",
  "content": {
    "content": "æ‰¾åˆ°50ç¯‡èµ„æ–™ä½œä¸ºå‚è€ƒ",
    "is_finished": false
  },
  "is_finished": false,
  "finish_reason": "",
  "type": "step"
}
```

### æ¶ˆæ¯ç±»å‹

- **step**: æ­¥éª¤ä¿¡æ¯
- **think**: æ€è€ƒè¿‡ç¨‹
- **text**: æ–‡æœ¬å†…å®¹

## ä½¿ç”¨ç¤ºä¾‹

### å‰ç«¯JavaScripté›†æˆ

```javascript
// å»ºç«‹SSEè¿æ¥
const eventSource = new EventSource('http://localhost:3001/events');

// ç›‘å¬æ¶ˆæ¯
eventSource.onmessage = function(event) {
  const data = JSON.parse(event.data);
  console.log('æ”¶åˆ°æ•°æ®:', data);
};

// å¼€å§‹æ¨é€
fetch('http://localhost:3001/start-stream', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ speed: 1000 })
});

// å…³é—­è¿æ¥
eventSource.close();
```

## æŠ€æœ¯æ ˆ

- **åç«¯**: Node.js, Express.js, Server-Sent Events
- **å‰ç«¯**: React 18, CSS3, JavaScript ES6+
- **æ•°æ®å­˜å‚¨**: JSONæ–‡ä»¶
- **å¼€å‘å·¥å…·**: npm, React Scripts

## å¼€å‘è¯´æ˜

### ä¿®æ”¹æ•°æ®
ç¼–è¾‘ `backend/data.json` æ–‡ä»¶æ¥ä¿®æ”¹æ¨é€çš„æ•°æ®å†…å®¹ã€‚

### è‡ªå®šä¹‰æ¨é€é€»è¾‘
ä¿®æ”¹ `backend/server.js` ä¸­çš„ `pushDataToClients` å‡½æ•°æ¥è‡ªå®šä¹‰æ¨é€é€»è¾‘ã€‚

### æ·»åŠ æ–°çš„æ¶ˆæ¯ç±»å‹
1. åœ¨ `data.json` ä¸­æ·»åŠ æ–°çš„æ¶ˆæ¯æ ¼å¼
2. åœ¨ `componentManager.js` ä¸­æ·»åŠ æ–°çš„ç±»å‹å¤„ç†é€»è¾‘
3. åˆ›å»ºå¯¹åº”çš„Reactç»„ä»¶ï¼ˆå¦‚éœ€è¦ï¼‰
4. åœ¨ `componentManager.js` çš„ `renderComponent` æ–¹æ³•ä¸­æ·»åŠ æ–°ç»„ä»¶çš„æ¸²æŸ“é€»è¾‘

## æ•…éšœæ’é™¤

### è¿æ¥å¤±è´¥
- æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œ
- ç¡®è®¤ç«¯å£3001æœªè¢«å ç”¨
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### æ•°æ®ä¸æ¨é€
- ç¡®è®¤å·²è°ƒç”¨ `/start-stream` ç«¯ç‚¹
- æ£€æŸ¥ `data.json` æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹æœåŠ¡å™¨æ§åˆ¶å°æ—¥å¿—

### å®¢æˆ·ç«¯æ–­å¼€
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ç¡®è®¤æµè§ˆå™¨æ”¯æŒSSE
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

## é¡¹ç›®çŠ¶æ€

âœ… åç«¯SSEæœåŠ¡å™¨ - å®Œæˆ  
âœ… JSONæ•°æ®å­˜å‚¨ - å®Œæˆ  
âœ… Reactå‰ç«¯åº”ç”¨ - å®Œæˆ  
âœ… æ•°æ®æ¨é€åŠŸèƒ½ - å®Œæˆ  
âœ… è¿æ¥ç®¡ç† - å®Œæˆ  
âœ… é”™è¯¯å¤„ç† - å®Œæˆ  
âœ… **æ¶æ„é‡æ„** - å®Œæˆ  
âœ… **ç»„ä»¶ç®¡ç†å™¨** - å®Œæˆ  
âœ… **ä»£ç ä¼˜åŒ–** - å®Œæˆ  

## ğŸ¯ é‡æ„äº®ç‚¹

- **App.js ç®€åŒ–**: ä» 273 è¡Œå‡å°‘åˆ° 163 è¡Œ
- **ç»„ä»¶ç®¡ç†å™¨**: ç»Ÿä¸€çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **èŒè´£åˆ†ç¦»**: æ¯ä¸ªæ¨¡å—éƒ½æœ‰æ˜ç¡®çš„èŒè´£
- **å¯æ‰©å±•æ€§**: æ·»åŠ æ–°ç»„ä»¶ç±»å‹æ›´åŠ ç®€å•
- **å¯ç»´æŠ¤æ€§**: ä»£ç ç»“æ„æ›´åŠ æ¸…æ™°

é¡¹ç›®å·²å®Œå…¨å¯ç”¨ï¼Œæ¶æ„å·²ä¼˜åŒ–ï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨å’Œè¿›ä¸€æ­¥å¼€å‘ï¼
